# 작업 내역: 접수등록 요금 및 오더메모 입력 구현

**작업 일자**: 2025-10-29
**작업 파일**: `Kai.Client.CallCenter/Networks/NwInsungs/InsungsAct_RcptRegPage.cs`

## 1. 구현 완료 기능

### 1.1 요금 입력 기능 (Line 2765-2779)
- **기본요금** 입력 및 검증
- **추가금액** 입력 및 검증
- **할인금액** 입력 및 검증
- **탁송료** 입력 및 검증

### 1.2 오더메모 입력 기능 (Line 2782-2790)
- **오더메모** 입력 및 검증
- 형식: `{KeyCode}/{OrderMemo}`

## 2. 새로 추가된 함수

### ResgistAndVerify요금Async (Line 3739-3765)

```csharp
private async Task<StdResult_Status> ResgistAndVerify요금Async(IntPtr hWnd, int value, string fieldName, CancelTokenControl ctrl, int retryCount = 3)
```

**목적**: 요금 필드에 숫자 입력 및 검증 (보안상 키보드 시뮬레이션만 사용)

**주요 로직**:
1. 포커스 설정: `Std32Window.SetFocusWithForegroundAsync(hWnd)`
2. 키보드로 숫자 입력: `Std32Key_Msg.KeyPost_Digit(hWnd, (uint)value)`
3. 입력 값 검증: `StdConvert.StringWonFormatToInt(Std32Window.GetWindowCaption(hWnd))`
4. 3회 재시도 (retryCount = 3)
5. 성공/실패 결과 반환

**보안 요구사항**:
- 요금 필드는 SetWindowText 사용 불가
- 반드시 키보드 시뮬레이션으로만 입력

## 3. 사용된 기존 함수

### WriteAndVerifyEditBoxAsync (Line 3011-3071)
- 오더메모 입력에 사용
- `OfrWork_Common.WriteEditBox_ToHndleAsyncWait` 사용
- 3회 재시도 로직 포함

## 4. 구현 패턴

### 4.1 요금 입력 패턴
```csharp
result = await ResgistAndVerify요금Async(wndRcpt.요금그룹_hWnd기본요금, tbOrder.FeeBasic, "기본요금", ctrl);
if (result.Result != StdResult.Success) return result;
```

### 4.2 오더메모 입력 패턴
```csharp
string orderMemo = $"{tbOrder.KeyCode}/{tbOrder.OrderMemo}";
result = await WriteAndVerifyEditBoxAsync(wndRcpt.우측하단_hWnd오더메모, orderMemo, "오더메모", ctrl);
if (result.Result != StdResult.Success) return result;
```

### 4.3 재시도 루프 패턴
```csharp
for (int i = 1; i <= retryCount; i++)
{
    await ctrl.WaitIfPausedOrCancelledAsync();
    // ... 작업 수행
    if (성공) break;
}
```

## 5. 핸들 정보 (InsungsInfo_Mem.cs)

### 요금 필드 핸들 (Line 263-266)
- `요금그룹_hWnd기본요금`
- `요금그룹_hWnd추가금액`
- `요금그룹_hWnd할인금액`
- `요금그룹_hWnd탁송료`

### 오더메모 핸들 (Line 209, 277)
- `우측하단_hWnd오더메모`

## 6. 준수한 기본수칙

### Rule 7: 함수 선언 수평 작성
```csharp
// ✅ 올바른 예
private async Task<StdResult_Status> ResgistAndVerify요금Async(IntPtr hWnd, int value, string fieldName, CancelTokenControl ctrl, int retryCount = 3)

// ❌ 잘못된 예 (여러 줄)
private async Task<StdResult_Status> ResgistAndVerify요금Async(
    IntPtr hWnd,
    int value,
    ...)
```

## 7. 에러 코드

- `ResgistAndVerify요금Async_01`: 요금 입력 실패
- `WriteAndVerifyEditBoxAsync_00`: EditBox 핸들 유효하지 않음
- `WriteAndVerifyEditBoxAsync_01`: EditBox 입력 실패
- `WriteAndVerifyEditBoxAsync_999`: 예외 발생

## 8. 빌드 결과

✅ **빌드 성공**: 오류 0개

## 9. 다음 작업 예정

현재 구현된 항목:
- ✅ 요금 그룹 입력 (기본요금, 추가금액, 할인금액, 탁송료)
- ✅ 오더메모 입력

다음 구현 대상 (주석으로 남아있는 부분):
- InsungsAct_RcptRegPage.cs 파일의 나머지 주석 구현 확인 필요
- 테스트 및 검증

## 10. 참고사항

### 보안 이슈
- 요금 필드는 보안상의 이유로 SetWindowText 사용 불가
- 반드시 키보드 시뮬레이션으로만 입력해야 함

### 재시도 횟수
- `CommonVars.c_nRepeatShort = 3` (3회)
- 함수 기본 파라미터로 설정 (컴파일 타임 상수 필요)

### 대기 시간
- `CommonVars.c_nWaitShort`: 짧은 대기
- `CommonVars.c_nWaitNormal`: 보통 대기
- `CommonVars.c_nWaitLong = 250ms`: 긴 대기

### 오더메모 형식
- `{KeyCode}/{OrderMemo}` 형식으로 조합하여 입력
