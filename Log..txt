=============================================================================
[작업 로그] Kai.Client.CallCenter
=============================================================================

## 2025-11-25 작업 기록

### 완료된 작업

1. **Cargo24s SetDG오더RectsAsync 완료**
   - RelChildRects 생성 로직 추가 (Cargo24sAct_RcptRegPage.cs:415-451)
   - Background Brightness 계산 추가
   - 패턴: ONECALL, INSUNG과 동일하게 통일

2. **MasterModeManager 커서 백업/복원 추가**
   - ShutdownAsync()에 커서 백업/복원 로직 추가 (MasterModeManager.cs:110-116)
   - 가상모니터 제거 시 Windows가 마우스를 자동 이동시키는 것 방지
   - InitializeAsync()와 대칭 구조로 통일

3. **자동배차 함수 리팩토링 (테스트용)**
   - NwOnecall.cs: AutoAllocAsync 인성 패턴 적용
   - NwCargo24.cs: AutoAllocAsync 인성 패턴 적용
   - InsungAutoAllocBase.cs: 테스트용 1000ms delay 추가
   - 패턴: #region 1. 사전작업 (TopMost 설정) + Task.Delay(1000)
   - 모든 네트워크 앱(인성/원콜/화물24시) 통일

---

## 다음 작업 계획

### 1. TbChar 작업 테스트 (우선순위: 높음)
   - 완료된 TbChar 기능 테스트
   - 검증 항목:
     * 문자 전송 기능
     * 문자 수신 기능
     * 에러 처리
     * 로그 기록

### 2. 화물24시(Cargo24) 자동배차 구현 (우선순위: 높음)
   - 참조: InsungAutoAllocBase.cs 패턴
   - 구현 항목:
     * #region 2. Local Variables 초기화
       - 큐에서 주문 리스트 가져오기
       - StateFlag별 리스트 분류
     * #region 3. Check Datagrid
       - Datagrid 윈도우 존재 확인
     * #region 4. Created Order 처리
       - 신규 접수 주문 처리
     * #region 5. 기존 주문 처리
       - Datagrid 페이지별 순회
       - OFR 및 상태 확인
       - 자동배차 실행

### 3. 원콜(Onecall) 자동배차 구현 (우선순위: 높음)
   - 참조: InsungAutoAllocBase.cs 패턴
   - 화물24시와 동일한 구조로 구현
   - 원콜 특화 로직 추가 필요 시 반영

### 4. 추가 검토 사항
   - AutoAllocAsync 에러 처리 보완
   - 성능 최적화 (필요 시)
   - 로그 메시지 통일

---

## 기술 메모

### Context 구조
- OnecallContext: MemInfo.Main.TopWnd_hWnd
- Cargo24Context: MemInfo.Main.TopWnd_hWnd
- InsungContext: MemInfo.Main.TopWnd_hWnd

### 공통 상수 (CommonVars)
- c_nWaitShort: 짧은 대기 시간
- c_nWaitLong: 긴 대기 시간
- c_nRepeatShort: 짧은 재시도 횟수
- c_nRepeatNormal: 일반 재시도 횟수

### 자동배차 패턴
```csharp
#region 1. 사전작업
await Std32Window.SetWindowTopMostAndReleaseAsync(hWnd, c_nWaitShort);
#endregion

#region 2. Local Variables 초기화
// 큐에서 주문 가져오기
// StateFlag별 분류
#endregion

#region 3. Check Datagrid
// Datagrid 존재 확인
#endregion

#region 4. Created Order 처리
// 신규 접수 처리
#endregion

#region 5. 기존 주문 처리
// 페이지별 순회 및 처리
#endregion
```

---

## 빌드 상태
- 최근 빌드: 성공
- 경고: 46개 (unreachable code 경고 포함, 테스트용이므로 무시)
- 오류: 0개

=============================================================================
