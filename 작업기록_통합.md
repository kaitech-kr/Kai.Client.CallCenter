# 작업 기록 통합 문서

**최종 업데이트**: 2025-12-06

---

## 📌 현재 작업 상태

### 🔨 다음 작업: 원콜(ONECALL) 자동배차 구현

**참고 파일**:
- 원콜: `NwOnecall.cs`, `OnecallAct_RcptRegPage.cs`, `OnecallAct_RcptRegPage.UI.cs`
- 인성/화물24시 (참고용)

**구현 순서**:
1. 초기화 - MainWnd, Datagrid 핸들 및 컬럼 경계 획득
2. 신규 접수 - RegistOrderToPopupAsync
3. 기존 주문 관리 - UpdateOrderToPopupAsync
4. 다이얼로그 처리 - SaveAndWaitClosedAsync 패턴 적용

**Cargo24 공용함수 패턴**:
- `SaveAndWaitClosedAsync(hWndClick, hWndOrg, buttonName, ctrl)` - 저장 + 다이얼로그 + 창닫힘 대기
- `CancelAndWaitClosedAsync(hWndClick, hWndPopup, hWndCheckDisabled, hWndClose, ctrl)` - 취소용
- `Set오더타입Async`, `Set운송비Async` - isUpdate 파라미터로 선택적 수정

**딜레이 패턴**: 버튼클릭→Long, TMessageForm발견→Normal, Yes/OK클릭→Long

---

## ✅ 최근 완료 작업 요약

### 2025-12-06
- **Set운송비Async** 공용함수 (운송비구분 라디오 + 운송비합계 Edit)
- **CancelAndWaitClosedAsync** 화물취소용 (버튼 Disabled 대기 + 닫기 클릭)
- **SaveAndWaitClosedAsync** 개선 (buttonName 파라미터, 딜레이 패턴, IsWindowVisible 필터)
- **UpdateOrderToPopupAsync** 화물취소/배차취소 분리

### 2025-12-05
- SaveAndWaitClosedAsync 공용함수 구현
- UpdateOrderToPopupAsync 선택적 수정 (밝기 기반 로딩 감지, 차량톤수 라디오버튼)

### 2025-12-04
- Cargo24 확인창/보고창 공용함수 (ClickConfirmYesButtonAsync, ClickReportOkButtonAsync)
- UpdateOrderToPopupAsync 상태변경 처리 (화물취소, 배차취소)

### 2025-12-02
- OFR avgBright 가중치 문제 해결 (0.9→0.7, 회색배경용)
- Cargo24 페이지별 리스트 검사 구조 구현

---

## 🔧 미적용 (대기 중)

- **Std32Mouse_Send.cs:195** - `BlockInput(true)` → `BlockInput(false)` 수정 필요

---

## 📊 참고: 인성 자동배차 구조

**핵심 함수**: CheckIsOrderAsync_InsungOrderManage → 접수Or배차/운행/완료/취소 분기

**40초 타이머**: 운행 진입 시 RunStartTime 설정, 40초 경과 시 Kai DB 업데이트

---

## 📋 참고: Datagrid 초기화

**공통 패턴**: 헤더 캡처 → 밝기 검출 → 경계 검출 → 첫/마지막 제거

**상수**: HEADER_HEIGHT=30, TARGET_ROW=2, OFR_HEIGHT=20, MIN_COLUMN_WIDTH=30

---

## 🔗 최근 커밋

- `d8a3668` - docs: 2025-12-06 작업 기록 업데이트 및 원콜 자동배차 계획
- `11cd58a` - feat: Cargo24 운송비 공용함수 및 화물취소 처리 개선
- `720fb6c` - feat: Cargo24 차종 WM_CHAR 방식 변경
- `9b7e509` - feat: Cargo24 UpdateOrder 선택적 수정 및 SaveAndWaitClosedAsync
- `f50f3ec` - feat: Cargo24 대기->접수 상태변경을 신규 주문으로 분류

---
