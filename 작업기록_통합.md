# ì‘ì—… ê¸°ë¡ í†µí•© ë¬¸ì„œ

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-05

---

## ğŸ“Œ í˜„ì¬ ì‘ì—… ìƒíƒœ

### ğŸ”¨ ë‹¤ìŒ ì‘ì—…: Cargo24 UpdateOrder ì°¨ì¢… ì½¤ë³´ë°•ìŠ¤ ì™„ì„±

**í˜„ì¬ ìœ„ì¹˜**: `Cargo24sAct_RcptRegPage.cs` - UpdateOrderToPopupAsync (Line 1676~)

**ë‹¤ìŒ TODO ìˆœì„œ**:
1. **ì°¨ì¢… ì½¤ë³´ë°•ìŠ¤ ì£¼ì„ í•´ì œ ë° í…ŒìŠ¤íŠ¸** - í˜„ì¬ ì£¼ì„ì²˜ë¦¬ ìƒíƒœ
2. **ìš´ì†¡ë¹„ ì„ íƒì  ìˆ˜ì •** - ìš´ì†¡ë¹„êµ¬ë¶„, ìš´ì†¡ë¹„í•©ê³„ ë¹„êµ í›„ ìˆ˜ì •
3. **5-3 í˜ì´ì§€ë³„ ë¦¬ìŠ¤íŠ¸ ê²€ì‚¬ ê³„ì†** - í˜ì´ì§€ ì´ë™, Row ë§¤ì¹­, ë°°ì°¨ ì²˜ë¦¬

**ì£¼ì„ì²˜ë¦¬ëœ ì½”ë“œ ìœ„ì¹˜**: Line 1676-1695
```csharp
//// 4-2. ì°¨ì¢… (ì½¤ë³´ë°•ìŠ¤) - í˜„ì¬ í…ìŠ¤íŠ¸ì™€ DB ê°’ ë¹„êµ
//var strTruck = GetTruckDetailStringFromInsung(order.TruckDetail);
```

**ì°¸ê³  íŒŒì¼**:
- ì¸ì„± ìë™ë°°ì°¨: `NwInsung01.cs`, `InsungsAct_RcptRegPage.UI.cs`
- í™”ë¬¼24ì‹œ: `NwCargo24.cs`, `Cargo24sAct_RcptRegPage.cs`, `Cargo24sAct_RcptRegPage.UI.cs`

---

## âœ… 2025-12-05 ì™„ë£Œ ì‘ì—…

### 1. SaveAndWaitClosedAsync ê³µìš©í•¨ìˆ˜ êµ¬í˜„

**íŒŒì¼**: `Cargo24sAct_RcptRegPage.UI.cs`

**êµ¬í˜„ ë‚´ìš©**:
```csharp
private async Task<bool> SaveAndWaitClosedAsync(IntPtr hWndClick, IntPtr hWndOrg, CancelTokenControl ctrl)
```
- ì €ì¥ ë²„íŠ¼ í´ë¦­ í›„ ë©”ì¸ì°½ ë‹«í ë•Œê¹Œì§€ ë°˜ë³µ
- TMessageForm í´ë˜ìŠ¤ë¡œ ì°¾ê¸° (ìº¡ì…˜ ë¬´ì‹œ)
- í™•ì¸ì°½(&Yes ë²„íŠ¼) ìë™ í´ë¦­
- ë³´ê³ ì°½(OK ë²„íŠ¼) ìë™ í´ë¦­
- ì ‘ìˆ˜ì €ì¥/ìˆ˜ì •ì €ì¥ ëª¨ë‘ ë™ì¼í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥

**ê¸°ì¡´ í•¨ìˆ˜ ì •ë¦¬**:
- `SaveRegistWorkAsync` â†’ `SaveAndWaitClosedAsync`ë¡œ ëŒ€ì²´
- ì£¼ì„ì²˜ë¦¬ëœ `SaveUpdateWorkAsync` ì‚­ì œ

### 2. ClickConfirmYesButtonAsync ê°œì„ 

**ë³€ê²½ì‚¬í•­**:
- `sDlgCaption` ê¸°ë³¸ê°’: `null` (ìº¡ì…˜ ë¬´ì‹œ, í´ë˜ìŠ¤ëª…ë§Œìœ¼ë¡œ ì°¾ê¸°)
- ë²„íŠ¼ ìº¡ì…˜ ëª©ë¡: `{ "&Yes", "OK" }` (í™•ì¸ì°½/ë³´ê³ ì°½ ëª¨ë‘ ì²˜ë¦¬)
- ë³µìˆ˜ ì‹¤í–‰ ì•± í™˜ê²½ì—ì„œ PID í™•ì¸ ë¡œì§ ìœ ì§€

### 3. UpdateOrderToPopupAsync ì„ íƒì  ìˆ˜ì • êµ¬í˜„

**íŒŒì¼**: `Cargo24sAct_RcptRegPage.cs`

**êµ¬í˜„ ì™„ë£Œ**:
1. **ì¡°íšŒë²„íŠ¼ ë°ê¸° ê¸°ë°˜ ë¡œë”© ê°ì§€**
   - ì»¤ì„œ ê¸°ë°˜ â†’ ë°ê¸° ê¸°ë°˜ ë³€ê²½ (ë‹¤ë¥¸ í™”ë©´ì— ì»¤ì„œ ìˆì„ ë•Œ ë¬¸ì œ í•´ê²°)
   - `WaitBrightnessLoadedAsync` í•¨ìˆ˜ ì‚¬ìš©

2. **ì°¨ëŸ‰í†¤ìˆ˜ ë¼ë””ì˜¤ë²„íŠ¼**
   - `GetCheckStatus` ì²´í¬ ìƒíƒœ í™•ì¸ í›„ ì„ íƒì  ìˆ˜ì •

3. **ì €ì¥ ë²„íŠ¼ í´ë¦­**
   - `SaveAndWaitClosedAsync` ì‚¬ìš©
   - í™•ì¸ì°½/ë³´ê³ ì°½ ìë™ ì²˜ë¦¬

**ë¯¸ì™„ë£Œ (ì£¼ì„ì²˜ë¦¬)**:
- ì°¨ì¢… ì½¤ë³´ë°•ìŠ¤: SetWindowCaption + 250ms ëŒ€ê¸° + Enter í‚¤
- ìš´ì†¡ë¹„ ì„ íƒì  ìˆ˜ì •

---

## âœ… 2025-12-04 ì™„ë£Œ ì‘ì—…

### 1. Cargo24 í™•ì¸ì°½/ë³´ê³ ì°½ ê³µìš© í•¨ìˆ˜ êµ¬í˜„

**íŒŒì¼**: `Cargo24sAct_RcptRegPage.UI.cs`

**êµ¬í˜„ ë‚´ìš©**:

1. **ClickConfirmYesButtonAsync** - í™•ì¸ì°½ Yes ë²„íŠ¼ í´ë¦­
2. **ClickReportOkButtonAsync** - ë³´ê³ ì°½ OK ë²„íŠ¼ í´ë¦­

### 2. UpdateOrderToPopupAsync ìƒíƒœë³€ê²½ ì²˜ë¦¬ êµ¬í˜„

**íŒŒì¼**: `Cargo24sAct_RcptRegPage.cs`

1. **í™”ë¬¼ì·¨ì†Œ** (targetState == "ì·¨ì†Œ")
   - í™•ì¸ì°½(Confirm/Yes) â†’ ë³´ê³ ì°½(Information/OK) â†’ `SuccessAndDestroy`

2. **ë°°ì°¨ì·¨ì†Œ** (targetState == "ì ‘ìˆ˜")
   - í™•ì¸ì°½(Confirm/Yes) â†’ `SuccessAndReEnqueue`

### 3. ì¸ì„± íŠ¸ëŸ­ ì½¤ë³´ë°•ìŠ¤ ì´ìŠˆ í•´ê²°

**íŒŒì¼**: `InsungsAct_RcptRegPage.UI.cs`

- TruckDetail="ì „ì²´"(index=0) ì¼€ì´ìŠ¤ ì²˜ë¦¬ ì™„ë£Œ

---

## âœ… 2025-12-02 ì™„ë£Œ ì‘ì—…

### 1. OFR avgBright ê°€ì¤‘ì¹˜ ë¬¸ì œ í•´ê²°

**ë¬¸ì œ**: Cargo24 ìˆœë²ˆ ì»¬ëŸ¼(íšŒìƒ‰ë°°ê²½ + ê²€ì •ê¸€ì”¨)ì—ì„œ "30", "32", "33" ë“± ë‘ ìë¦¬ ìˆ«ì ì¸ì‹ ì‹¤íŒ¨

**ì›ì¸**:
- avgBright2 ì„ê³„ê°’ì´ ~142ë¡œ ê³„ì‚°ë¨
- Anti-aliasing í”½ì…€ ë°ê¸°ê°€ ~107-147 ë²”ìœ„
- ë¬¸ì ì‚¬ì´ anti-aliasing í”½ì…€ì´ ì„ê³„ê°’ë³´ë‹¤ ì–´ë‘ì›Œ ë¬¸ì ë¶„ë¦¬ ì‹¤íŒ¨

**í•´ê²°**:
- `GetAverageBrightness_FromColorBitmapFast` ê°€ì¤‘ì¹˜ë¥¼ 0.9 â†’ 0.7ë¡œ ì¡°ì •
- ì„ê³„ê°’ì´ ~100ìœ¼ë¡œ ë‚®ì•„ì ¸ anti-aliasing í”½ì…€ í†µê³¼

**íŒŒì¼**: `OfrWork_Commons.cs`

```csharp
// weightBrightness íŒŒë¼ë¯¸í„° ì¶”ê°€
public static async Task<StdResult_String> OfrStr_SeqCharAsync(
    Draw.Bitmap bmpSource,
    double weightBrightness,  // 0.7: íšŒìƒ‰ë°°ê²½, 0.9: í°ë°°ê²½
    bool bEdit = true)
```

**ì ìš©**:
- Cargo24: `0.7` (íšŒìƒ‰ ë°°ê²½)
- Insung: `0.9` (í° ë°°ê²½) + ì£¼ì„ `// ì˜ì—­ì¶”ì¶œ ëª»í• ì‹œ ê°€ì¤‘ì¹˜ì¡°ì •`

### 2. Cargo24 AutoAlloc 5-3 í˜ì´ì§€ë³„ ë¦¬ìŠ¤íŠ¸ ê²€ì‚¬ êµ¬ì¡° êµ¬í˜„

**íŒŒì¼**: `NwCargo24.cs`, `Cargo24sAct_RcptRegPage.cs`

**êµ¬í˜„ ë‚´ìš©**:

1. **GetExpectedFirstRowNum í•¨ìˆ˜** - ì¸ì„± ë¡œì§ ì¸ìš©
   ```csharp
   public static int GetExpectedFirstRowNum(int nTotRows, int nRowsPerPage, int pageIdx)
   ```

2. **ìœ íš¨ ë¡œìš° ìˆ˜ ê³„ì‚°**
   ```csharp
   int nValidRowCount;
   if (pageIdx < nTotPage - 1)
       nValidRowCount = nRowCount;  // ë§ˆì§€ë§‰ í˜ì´ì§€ ì•„ë‹ˆë©´ í˜ì´ì§€ë‹¹ ë¡œìš° ìˆ˜
   else
   {
       nValidRowCount = nThisTotCount % nRowCount;  // ë§ˆì§€ë§‰ í˜ì´ì§€: ë‚˜ë¨¸ì§€
       if (nValidRowCount == 0) nValidRowCount = nRowCount;
   }
   ```

3. **í˜ì´ì§€ ê²€ì¦ ë£¨í”„ êµ¬ì¡°**
   ```csharp
   for (int pageIdx = 0; pageIdx < nTotPage; pageIdx++)
   {
       // 5-3-1. í˜„ì¬ í˜ì´ì§€ í™•ì¸
       int expectedFirstNum = GetExpectedFirstRowNum(nThisTotCount, nRowCount, pageIdx);
       int actualFirstNum = await ReadFirstRowNumAsync(nValidRowCount);

       if (actualFirstNum != expectedFirstNum)
       {
           // TODO: í˜ì´ì§€ ì´ë™ ì²˜ë¦¬
       }

       // 5-3-2. Rowë³„ ìˆœë²ˆ ì½ê¸° ë° listEtcGroup ë§¤ì¹­ â†’ TODO
       // 5-3-3. ë§¤ì¹­ëœ Row ë°°ì°¨ ì²˜ë¦¬ â†’ TODO
   }
   ```

**ì°¸ê³ **: ì²­í¬(100í–‰) ë‹¨ìœ„ëŠ” ë‹¤ë£¨ì§€ ì•ŠìŒ - í˜„ì¬ ë¡œë“œëœ ë°ì´í„°(ìµœëŒ€ 4í˜ì´ì§€)ë§Œ ì²˜ë¦¬

---

## âœ… 2025-11-26 ì™„ë£Œ ì‘ì—…

### 1. OFR ê²€ìƒ‰ ì„±ê³µ ì‹œ Searched ì¹´ìš´íŠ¸ ì¦ê°€ ë¡œì§

**íŒŒì¼**: `OfrWork_Commons.cs`

**êµ¬í˜„ ë‚´ìš©**:

1. **TbChar ê²€ìƒ‰ ì„±ê³µ ì‹œ Searched ì¦ê°€** (Line 279-293)
   ```csharp
   private static async Task<string> SelectCharByBasicAsync(int width, int height, string hexString)
   {
       PgResult_TbChar result = await PgService_TbChar.SelectRowByBasicAsync(width, height, hexString);
       if (result?.tbChar != null)
       {
           // Searchedê°€ 10ë³´ë‹¤ ì‘ìœ¼ë©´ 1 ì¦ê°€í•˜ì—¬ ì—…ë°ì´íŠ¸
           if (result.tbChar.Searched < 10)
           {
               result.tbChar.Searched++;
               _ = PgService_TbChar.UpdateRowAsync(result.tbChar);
           }
           return result.tbChar.Character;
       }
       return null;
   }
   ```

2. **TbText ê²€ìƒ‰ ì„±ê³µ ì‹œ Searched ì¦ê°€** (2ê³³)
   - `OfrImage_ExactDrawRelRectAsync` (Line 250-258)
   - `OfrStr_ComplexCharSetAsync` (Line 529-534)

### 2. TbCharFail ì €ì¥ ë¡œì§ í™œì„±í™”

**íŒŒì¼**: `OfrWork_Commons.cs`

- OFR ì‹¤íŒ¨ ì‹œ TbCharFail í…Œì´ë¸”ì— ì €ì¥
- ì¤‘ë³µ ì²´í¬ í¬í•¨ (ë™ì¼ íŒ¨í„´ ì¬ì €ì¥ ë°©ì§€)

### 3. bEdit íŒŒë¼ë¯¸í„° ì¼ê´€ì„± ìˆ˜ì •

**íŒŒì¼ë“¤**:
- `InsungsAct_RcptRegPage.cs` (Line 705)
- `Cargo24sAct_RcptRegPage.cs` (Lines 374, 656)
- `OnecallAct_RcptRegPage.cs` (Lines 168, 250)

**ìˆ˜ì • ë‚´ìš©**: `bEdit: false` â†’ `bEdit: bEdit` (íŒŒë¼ë¯¸í„° ì „ë‹¬)

### 4. ImageToCharWnd ê°œì„ 

**íŒŒì¼**: `ImageToCharWnd.xaml.cs`

- ì™¸ë¶€ ì…ë ¥ ì°¨ë‹¨ í•´ì œ: `StdWin32.BlockInput(false)`
- ë¬¸ì ì˜ì—­ ë¹¨ê°„ ì‚¬ê°í˜• í‘œì‹œ (DisplayBitmaps í•¨ìˆ˜)

---

## ğŸ”§ ë¯¸ì ìš© (ëŒ€ê¸° ì¤‘)

### Std32Mouse_Send.cs BlockInput ë²„ê·¸
- Line 195: `BlockInput(true)` â†’ `BlockInput(false)` ìˆ˜ì • í•„ìš”
- ì‚¬ìš©ì ì§€ì‹œ: "ë‚˜ì¤‘ì— ë¬¸ì œ ìƒê¸°ë©´ ê·¸ë•Œ ì¡°ì¹˜"

---

## ğŸ“Š ì¸ì„± ìë™ë°°ì°¨ êµ¬ì¡° ìš”ì•½

### í•µì‹¬ í•¨ìˆ˜ë“¤

1. **CheckIsOrderAsync_InsungOrderManage** - ë©”ì¸ ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜
2. **InsungOrderManage_ì ‘ìˆ˜Orë°°ì°¨Async** - ì ‘ìˆ˜/ë°°ì°¨ ìƒíƒœ ì²˜ë¦¬
3. **InsungOrderManage_ìš´í–‰Async** - ìš´í–‰ ìƒíƒœ + 40ì´ˆ íƒ€ì´ë¨¸
4. **InsungOrderManage_ì™„ë£ŒAsync** - ì™„ë£Œ ìƒíƒœ ì²˜ë¦¬
5. **InsungOrderManage_ì·¨ì†ŒAsync** - ì·¨ì†Œ ìƒíƒœ ì²˜ë¦¬

### 40ì´ˆ íƒ€ì´ë¨¸ ë¡œì§

```csharp
// ìš´í–‰ ì§„ì… ì‹œ
if (item.RunStartTime == null)
{
    item.RunStartTime = DateTime.Now;
    item.DriverPhone = await GetRowDriverPhNoAsync(...);
}

// 40ì´ˆ ê²½ê³¼ ì‹œ
if (elapsed.TotalSeconds >= 40)
{
    // Kai DB ì—…ë°ì´íŠ¸, ë‹¤ë¥¸ ì•± ì·¨ì†Œ
}

// ìš´í–‰ ì·¨ì†Œ ì‹œ (40ì´ˆ ë‚´)
item.RunStartTime = null;
item.DriverPhone = null;
```

---

## ğŸ“‹ Datagrid ì´ˆê¸°í™” êµ¬ì¡°

### ê³µí†µ íŒ¨í„´ (ì¸ì„±/í™”ë¬¼24ì‹œ/ì›ì½œ)

1. **í—¤ë” ìº¡ì²˜**: Datagrid í•¸ë“¤ + ìƒëŒ€ì¢Œí‘œë¡œ í—¤ë”ë§Œ ìº¡ì²˜
2. **ë°ê¸° ê²€ì¶œ**: `GetMinBrightnessAtRow_FromColorBitmapFast`
3. **ê²½ê³„ ê²€ì¶œ**: `GetLeftWidthList_FromBool1Array`
4. **ì²«/ë§ˆì§€ë§‰ ì œê±°**: í…Œë‘ë¦¬ + ë ì˜ì—­

### ì£¼ìš” ìƒìˆ˜

```csharp
private const int HEADER_HEIGHT = 30;
private const int TARGET_ROW = 2;
private const int OFR_HEIGHT = 20;
private const int MIN_COLUMN_WIDTH = 30;
```

---

## ğŸ”— ìµœê·¼ ì»¤ë°‹

- `3932194` - feat: ìë™ë°°ì°¨ ì´ˆê¸° êµ¬ì¡° í†µì¼ ë° MasterModeManager ê°œì„  (2025-11-23)
- `4af4279` - docs: 2025-11-23 ONECALL ì‘ì—… ê¸°ë¡ ì¶”ê°€
- `dbe76db` - feat: Onecall ì ‘ìˆ˜ë“±ë¡Page ì´ˆê¸°í™” êµ¬í˜„
- `d472584` - refactor: Cargo24 ì½”ë“œ í’ˆì§ˆ ê°œì„  ë° MainWnd ì´ˆê¸°í™” ì•ˆì •ì„± í–¥ìƒ

---
