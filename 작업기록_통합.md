# ì‘ì—… ê¸°ë¡ í†µí•© ë¬¸ì„œ

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-12-02

---

## ğŸ“Œ í˜„ì¬ ì‘ì—… ìƒíƒœ

### ğŸ”¨ ë‹¤ìŒ ì‘ì—…: Cargo24 AutoAlloc 5-3 êµ¬í˜„ ê³„ì†

**í˜„ì¬ ìœ„ì¹˜**: `NwCargo24.cs` - 5-3 í˜ì´ì§€ë³„ ë¦¬ìŠ¤íŠ¸ ê²€ì‚¬ ë° ì²˜ë¦¬

**ë‹¤ìŒ TODO ìˆœì„œ**:
1. **5-3-1 í˜ì´ì§€ ë¶ˆì¼ì¹˜ ì‹œ ì´ë™ ì²˜ë¦¬** - í˜ì´ì§€ ì´ë™ ë¡œì§ êµ¬í˜„
2. **5-3-2 Rowë³„ ìˆœë²ˆ ì½ê¸° ë° listEtcGroup ë§¤ì¹­** - ê° Rowì˜ ìˆœë²ˆ OFR â†’ listEtcGroup ë§¤ì¹­
3. **5-3-3 ë§¤ì¹­ëœ Row ë°°ì°¨ ì²˜ë¦¬** - ë°°ì°¨ ì‹¤í–‰

**ì°¸ê³  íŒŒì¼**:
- ì¸ì„± ìë™ë°°ì°¨: `NwInsung01.cs`, `InsungsAct_RcptRegPage.UI.cs`
- í™”ë¬¼24ì‹œ: `NwCargo24.cs`, `Cargo24sAct_RcptRegPage.cs`

---

## âœ… 2025-12-02 ì™„ë£Œ ì‘ì—…

### 1. OFR avgBright ê°€ì¤‘ì¹˜ ë¬¸ì œ í•´ê²°

**ë¬¸ì œ**: Cargo24 ìˆœë²ˆ ì»¬ëŸ¼(íšŒìƒ‰ë°°ê²½ + ê²€ì •ê¸€ì”¨)ì—ì„œ "30", "32", "33" ë“± ë‘ ìë¦¬ ìˆ«ì ì¸ì‹ ì‹¤íŒ¨

**ì›ì¸**:
- avgBright2 ì„ê³„ê°’ì´ ~142ë¡œ ê³„ì‚°ë¨
- Anti-aliasing í”½ì…€ ë°ê¸°ê°€ ~107-147 ë²”ìœ„
- ë¬¸ì ì‚¬ì´ anti-aliasing í”½ì…€ì´ ì„ê³„ê°’ë³´ë‹¤ ì–´ë‘ì›Œ ë¬¸ì ë¶„ë¦¬ ì‹¤íŒ¨

**í•´ê²°**:
- `GetAverageBrightness_FromColorBitmapFast` ê°€ì¤‘ì¹˜ë¥¼ 0.9 â†’ 0.7ë¡œ ì¡°ì •
- ì„ê³„ê°’ì´ ~100ìœ¼ë¡œ ë‚®ì•„ì ¸ anti-aliasing í”½ì…€ í†µê³¼

**íŒŒì¼**: `OfrWork_Commons.cs`

```csharp
// weightBrightness íŒŒë¼ë¯¸í„° ì¶”ê°€
public static async Task<StdResult_String> OfrStr_SeqCharAsync(
    Draw.Bitmap bmpSource,
    double weightBrightness,  // 0.7: íšŒìƒ‰ë°°ê²½, 0.9: í°ë°°ê²½
    bool bEdit = true)
```

**ì ìš©**:
- Cargo24: `0.7` (íšŒìƒ‰ ë°°ê²½)
- Insung: `0.9` (í° ë°°ê²½) + ì£¼ì„ `// ì˜ì—­ì¶”ì¶œ ëª»í• ì‹œ ê°€ì¤‘ì¹˜ì¡°ì •`

### 2. Cargo24 AutoAlloc 5-3 í˜ì´ì§€ë³„ ë¦¬ìŠ¤íŠ¸ ê²€ì‚¬ êµ¬ì¡° êµ¬í˜„

**íŒŒì¼**: `NwCargo24.cs`, `Cargo24sAct_RcptRegPage.cs`

**êµ¬í˜„ ë‚´ìš©**:

1. **GetExpectedFirstRowNum í•¨ìˆ˜** - ì¸ì„± ë¡œì§ ì¸ìš©
   ```csharp
   public static int GetExpectedFirstRowNum(int nTotRows, int nRowsPerPage, int pageIdx)
   ```

2. **ìœ íš¨ ë¡œìš° ìˆ˜ ê³„ì‚°**
   ```csharp
   int nValidRowCount;
   if (pageIdx < nTotPage - 1)
       nValidRowCount = nRowCount;  // ë§ˆì§€ë§‰ í˜ì´ì§€ ì•„ë‹ˆë©´ í˜ì´ì§€ë‹¹ ë¡œìš° ìˆ˜
   else
   {
       nValidRowCount = nThisTotCount % nRowCount;  // ë§ˆì§€ë§‰ í˜ì´ì§€: ë‚˜ë¨¸ì§€
       if (nValidRowCount == 0) nValidRowCount = nRowCount;
   }
   ```

3. **í˜ì´ì§€ ê²€ì¦ ë£¨í”„ êµ¬ì¡°**
   ```csharp
   for (int pageIdx = 0; pageIdx < nTotPage; pageIdx++)
   {
       // 5-3-1. í˜„ì¬ í˜ì´ì§€ í™•ì¸
       int expectedFirstNum = GetExpectedFirstRowNum(nThisTotCount, nRowCount, pageIdx);
       int actualFirstNum = await ReadFirstRowNumAsync(nValidRowCount);

       if (actualFirstNum != expectedFirstNum)
       {
           // TODO: í˜ì´ì§€ ì´ë™ ì²˜ë¦¬
       }

       // 5-3-2. Rowë³„ ìˆœë²ˆ ì½ê¸° ë° listEtcGroup ë§¤ì¹­ â†’ TODO
       // 5-3-3. ë§¤ì¹­ëœ Row ë°°ì°¨ ì²˜ë¦¬ â†’ TODO
   }
   ```

**ì°¸ê³ **: ì²­í¬(100í–‰) ë‹¨ìœ„ëŠ” ë‹¤ë£¨ì§€ ì•ŠìŒ - í˜„ì¬ ë¡œë“œëœ ë°ì´í„°(ìµœëŒ€ 4í˜ì´ì§€)ë§Œ ì²˜ë¦¬

---

## âœ… 2025-11-26 ì™„ë£Œ ì‘ì—…

### 1. OFR ê²€ìƒ‰ ì„±ê³µ ì‹œ Searched ì¹´ìš´íŠ¸ ì¦ê°€ ë¡œì§

**íŒŒì¼**: `OfrWork_Commons.cs`

**êµ¬í˜„ ë‚´ìš©**:

1. **TbChar ê²€ìƒ‰ ì„±ê³µ ì‹œ Searched ì¦ê°€** (Line 279-293)
   ```csharp
   private static async Task<string> SelectCharByBasicAsync(int width, int height, string hexString)
   {
       PgResult_TbChar result = await PgService_TbChar.SelectRowByBasicAsync(width, height, hexString);
       if (result?.tbChar != null)
       {
           // Searchedê°€ 10ë³´ë‹¤ ì‘ìœ¼ë©´ 1 ì¦ê°€í•˜ì—¬ ì—…ë°ì´íŠ¸
           if (result.tbChar.Searched < 10)
           {
               result.tbChar.Searched++;
               _ = PgService_TbChar.UpdateRowAsync(result.tbChar);
           }
           return result.tbChar.Character;
       }
       return null;
   }
   ```

2. **TbText ê²€ìƒ‰ ì„±ê³µ ì‹œ Searched ì¦ê°€** (2ê³³)
   - `OfrImage_ExactDrawRelRectAsync` (Line 250-258)
   - `OfrStr_ComplexCharSetAsync` (Line 529-534)

### 2. TbCharFail ì €ì¥ ë¡œì§ í™œì„±í™”

**íŒŒì¼**: `OfrWork_Commons.cs`

- OFR ì‹¤íŒ¨ ì‹œ TbCharFail í…Œì´ë¸”ì— ì €ì¥
- ì¤‘ë³µ ì²´í¬ í¬í•¨ (ë™ì¼ íŒ¨í„´ ì¬ì €ì¥ ë°©ì§€)

### 3. bEdit íŒŒë¼ë¯¸í„° ì¼ê´€ì„± ìˆ˜ì •

**íŒŒì¼ë“¤**:
- `InsungsAct_RcptRegPage.cs` (Line 705)
- `Cargo24sAct_RcptRegPage.cs` (Lines 374, 656)
- `OnecallAct_RcptRegPage.cs` (Lines 168, 250)

**ìˆ˜ì • ë‚´ìš©**: `bEdit: false` â†’ `bEdit: bEdit` (íŒŒë¼ë¯¸í„° ì „ë‹¬)

### 4. ImageToCharWnd ê°œì„ 

**íŒŒì¼**: `ImageToCharWnd.xaml.cs`

- ì™¸ë¶€ ì…ë ¥ ì°¨ë‹¨ í•´ì œ: `StdWin32.BlockInput(false)`
- ë¬¸ì ì˜ì—­ ë¹¨ê°„ ì‚¬ê°í˜• í‘œì‹œ (DisplayBitmaps í•¨ìˆ˜)

---

## ğŸ”§ ë¯¸ì ìš© (ëŒ€ê¸° ì¤‘)

### Std32Mouse_Send.cs BlockInput ë²„ê·¸
- Line 195: `BlockInput(true)` â†’ `BlockInput(false)` ìˆ˜ì • í•„ìš”
- ì‚¬ìš©ì ì§€ì‹œ: "ë‚˜ì¤‘ì— ë¬¸ì œ ìƒê¸°ë©´ ê·¸ë•Œ ì¡°ì¹˜"

---

## ğŸ“Š ì¸ì„± ìë™ë°°ì°¨ êµ¬ì¡° ìš”ì•½

### í•µì‹¬ í•¨ìˆ˜ë“¤

1. **CheckIsOrderAsync_InsungOrderManage** - ë©”ì¸ ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜
2. **InsungOrderManage_ì ‘ìˆ˜Orë°°ì°¨Async** - ì ‘ìˆ˜/ë°°ì°¨ ìƒíƒœ ì²˜ë¦¬
3. **InsungOrderManage_ìš´í–‰Async** - ìš´í–‰ ìƒíƒœ + 40ì´ˆ íƒ€ì´ë¨¸
4. **InsungOrderManage_ì™„ë£ŒAsync** - ì™„ë£Œ ìƒíƒœ ì²˜ë¦¬
5. **InsungOrderManage_ì·¨ì†ŒAsync** - ì·¨ì†Œ ìƒíƒœ ì²˜ë¦¬

### 40ì´ˆ íƒ€ì´ë¨¸ ë¡œì§

```csharp
// ìš´í–‰ ì§„ì… ì‹œ
if (item.RunStartTime == null)
{
    item.RunStartTime = DateTime.Now;
    item.DriverPhone = await GetRowDriverPhNoAsync(...);
}

// 40ì´ˆ ê²½ê³¼ ì‹œ
if (elapsed.TotalSeconds >= 40)
{
    // Kai DB ì—…ë°ì´íŠ¸, ë‹¤ë¥¸ ì•± ì·¨ì†Œ
}

// ìš´í–‰ ì·¨ì†Œ ì‹œ (40ì´ˆ ë‚´)
item.RunStartTime = null;
item.DriverPhone = null;
```

---

## ğŸ“‹ Datagrid ì´ˆê¸°í™” êµ¬ì¡°

### ê³µí†µ íŒ¨í„´ (ì¸ì„±/í™”ë¬¼24ì‹œ/ì›ì½œ)

1. **í—¤ë” ìº¡ì²˜**: Datagrid í•¸ë“¤ + ìƒëŒ€ì¢Œí‘œë¡œ í—¤ë”ë§Œ ìº¡ì²˜
2. **ë°ê¸° ê²€ì¶œ**: `GetMinBrightnessAtRow_FromColorBitmapFast`
3. **ê²½ê³„ ê²€ì¶œ**: `GetLeftWidthList_FromBool1Array`
4. **ì²«/ë§ˆì§€ë§‰ ì œê±°**: í…Œë‘ë¦¬ + ë ì˜ì—­

### ì£¼ìš” ìƒìˆ˜

```csharp
private const int HEADER_HEIGHT = 30;
private const int TARGET_ROW = 2;
private const int OFR_HEIGHT = 20;
private const int MIN_COLUMN_WIDTH = 30;
```

---

## ğŸ”— ìµœê·¼ ì»¤ë°‹

- `3932194` - feat: ìë™ë°°ì°¨ ì´ˆê¸° êµ¬ì¡° í†µì¼ ë° MasterModeManager ê°œì„  (2025-11-23)
- `4af4279` - docs: 2025-11-23 ONECALL ì‘ì—… ê¸°ë¡ ì¶”ê°€
- `dbe76db` - feat: Onecall ì ‘ìˆ˜ë“±ë¡Page ì´ˆê¸°í™” êµ¬í˜„
- `d472584` - refactor: Cargo24 ì½”ë“œ í’ˆì§ˆ ê°œì„  ë° MainWnd ì´ˆê¸°í™” ì•ˆì •ì„± í–¥ìƒ

---
