# Kai 오더 모델(TbOrder) 구조 개선안

## 1. 개요
기존 `TbOrder` 모델을 확장하여 외부 연동(인성, 화물24, 원콜) 및 현장 비즈니스 로직(다중 배송 옵션, 정산 등)을 완벽하게 수용하기 위한 설계안입니다.

---

## 2. 핵심 설계 철학: [Enum + Flags]
- **기본 속성 (Single Select)**: 차량 톤수, 차종 등 배타적인 속성은 `Enum` (단일 선택)
- **옵션 속성 (Multi Select)**: 작업 방식, 운행 성격 등 중복 가능한 속성은 `Flags` (비트 연산)

---

## 3. 신규 및 확장 필드 정의 (TbOrder)

### A. 차량 및 화물 옵션 (Flags & Enum)
```csharp
// 1. 차량 지정 (기본)
public int CarWeightCode { get; set; }  // Enum: 1톤, 5톤, 다마스 등
public int CarTypeCode { get; set; }    // Enum: 카고, 윙, 탑 등

// 2. 차량 옵션 (Flags) - 차에 달려 있어야 하는 장비
// [ ]리프트 [ ]호로 [ ]냉동 [ ]무진동 [ ]항온항습
public int CarOptionFlags { get; set; } 

// 3. 작업 옵션 (Flags) - 상/하차지 별도 관리 ★
// [ ]수작업 [ ]지게차 [ ]호이스트 [ ]사다리 [ ]계단
public int StartLoadOptionFlags { get; set; } // 상차지 작업
public int DestLoadOptionFlags { get; set; }  // 하차지 작업

// 4. 운행 성격 (Flags) - 오더의 특성
// [ ]긴급 [ ]왕복 [ ]혼적 [ ]동승 [ ]경유 [ ]예약
public int RunOptionFlags { get; set; }
```

### B. 금액 및 정산 (Fee Structure)
- **전략**: `FeeTotal`(총액)과 `FeeCommi`(수수료)를 저장하고, 기사 지급액(`FeeNet`)은 역산한다. (수수료 중심 정산)

```csharp
// 1. 총 운임 (화주 청구액)
public int FeeTotal { get; set; }

// 2. 중개 수수료 (CallCenter 수익) ★ 저장 필드
public int FeeCommi { get; set; }

// 3. 기사 실지급액 (순운임) - [자동 계산 프로퍼티]
// public int FeeNet => FeeTotal - FeeCommi;
```

// 그 외 추가/공제
public int FeeAdd { get; set; }   // 추가 운임 (+)
public int FeeDed { get; set; }   // 공제 운임 (-)
public int FeeConsign { get; set; }// 탁송/대납료 (단순 통과)


### C. 외부 앱 연동 (External Apps)
```csharp
// 단순 ID 외에 현재 진행 상태 관리 (Colors: None, Reg, Alloc, Cancel...)
public int ExtInsung1State { get; set; }
public int ExtInsung2State { get; set; }
public int ExtCargo24State { get; set; }
public int ExtOnecallState { get; set; }
public string ExtErrorMsg { get; set; }   // 연동 에러 메시지
```

### D. CS 및 이력 관리
```csharp
public string CancelReason { get; set; }  // 취소 사유
public DateTime? CancelTime { get; set; } // 취소 시간
public string ImgUrl { get; set; }        // 서명/화물 사진 경로 (DB 부하 감소)
```

---

## 4. Enum 코드 정의 (제안)

### CarWeight (차량 톤수)
- `Damas` (다마스)
- `Labo` (라보)
- `W1_0` (1톤)
- `W1_4` (1.4톤)
- `W2_5` (2.5톤)
- `W3_5` (3.5톤)
- `W5_0` (5톤)
- `W5_0_Plus` (5톤 축/플러스)
- `W11_0` (11톤)
- `W25_0` (25톤/추레라)

### CarType (차량 종류)
- `Cargo` (카고/일반)
- `Van` (밴/탑/호로)
- `Wing` (윙바디)
- `Truck` (트럭 - 소형 구분용)

### Flags: RunOptions (운행 성격)
- `Urgent` (긴급)
- `Message` (메시지/공지) -> *문의 오더 등*
- `Round` (왕복)
- `Mixed` (혼적/합짐)
- `Ride` (동승)
- `Stopover` (경유)
- `Reserve` (예약)

---

## 5. UI 구현 전략
- **하이브리드 바인딩**: DB에는 `int Code`로 저장하되, 모델에 `string Text` 프로퍼티를 두어 UI에서는 "긴급, 왕복" 처럼 텍스트로 표시.
- **DataGrid**: 상태(Status)는 색상 뱃지, 옵션(Options)은 아이콘 또는 약어 태그(`[긴급]`)로 표현하여 가독성 확보.
